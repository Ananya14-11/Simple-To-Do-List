<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a nice font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Flatpickr for date selection -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
      /* Custom styles */
      body {
        font-family: "Inter", sans-serif;
      }
      /* Style for completed tasks */
      .completed {
        text-decoration: line-through;
        color: #9ca3af; /* gray-400 */
      }
      /* Simple transition for list items */
      li {
        transition: background-color 0.2s ease-in-out;
      }
      /* Priority badge styles */
      .priority-low {
        background-color: #d1fae5; /* green-100 */
        color: #065f46; /* green-800 */
      }
      .priority-medium {
        background-color: #fef3c7; /* yellow-100 */
        color: #92400e; /* yellow-800 */
      }
      .priority-high {
        background-color: #fee2e2; /* red-100 */
        color: #991b1b; /* red-800 */
      }
      /* Category badge styles */
      .category-personal {
        background-color: #dbeafe; /* blue-100 */
        color: #1e40af; /* blue-800 */
      }
      .category-work {
        background-color: #f3e8ff; /* purple-100 */
        color: #6b21a8; /* purple-800 */
      }
      .category-shopping {
        background-color: #fce7f3; /* pink-100 */
        color: #9d174d; /* pink-800 */
      }
      .category-health {
        background-color: #dcfce7; /* green-100 */
        color: #166534; /* green-800 */
      }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 p-6">
      <!-- Header -->
      <div class="flex items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800 flex-grow">To-Do List</h1>
        <svg
          class="w-8 h-8 text-blue-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
          ></path>
        </svg>
      </div>

      <!-- Input Section -->
      <div class="mb-6 space-y-4">
        <div class="flex gap-3">
          <input
            type="text"
            id="taskInput"
            class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
            placeholder="Add a new task..."
          />
          <button
            id="addTaskBtn"
            class="bg-blue-500 text-white font-semibold px-5 py-3 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition shadow-md hover:shadow-lg"
          >
            Add
          </button>
        </div>
        
        <!-- Task Options -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Category Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
            <select id="categorySelect" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="personal">Personal</option>
              <option value="work">Work</option>
              <option value="shopping">Shopping</option>
              <option value="health">Health</option>
            </select>
          </div>
          
          <!-- Priority Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
            <select id="prioritySelect" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          
          <!-- Due Date Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
            <input
              type="text"
              id="dueDateInput"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Select date"
            />
          </div>
        </div>
      </div>

      <!-- Task List -->
      <div>
        <ul id="taskList" class="space-y-3">
          <!-- Tasks will be dynamically added here -->
        </ul>
      </div>
    </div>

    <script>
      // Get references to the HTML elements
      const taskInput = document.getElementById("taskInput");
      const addTaskBtn = document.getElementById("addTaskBtn");
      const taskList = document.getElementById("taskList");
      const categorySelect = document.getElementById("categorySelect");
      const prioritySelect = document.getElementById("prioritySelect");
      const dueDateInput = document.getElementById("dueDateInput");

      // Initialize flatpickr for date selection
      flatpickr(dueDateInput, {
        dateFormat: "Y-m-d",
        minDate: "today"
      });

      // Function to save all tasks to localStorage
      function saveTasks() {
        const tasks = [];
        // Select all list items in the task list
        taskList.querySelectorAll("li").forEach((li) => {
          const taskSpan = li.querySelector(".task-text");
          const categoryBadge = li.querySelector(".category-badge");
          const priorityBadge = li.querySelector(".priority-badge");
          const dueDateSpan = li.querySelector(".due-date");
          
          if (taskSpan) {
            tasks.push({
              text: taskSpan.textContent,
              completed: taskSpan.classList.contains("completed"),
              category: categoryBadge ? categoryBadge.dataset.category : "personal",
              priority: priorityBadge ? priorityBadge.dataset.priority : "medium",
              dueDate: dueDateSpan ? dueDateSpan.textContent : ""
            });
          }
        });
        // Store the array as a JSON string
        localStorage.setItem("todoListTasks", JSON.stringify(tasks));
      }

      // Function to create a new task item
      function createTask(taskText, isCompleted = false, category = "personal", priority = "medium", dueDate = "") {
        // Create list item
        const li = document.createElement("li");
        li.className =
          "flex flex-col md:flex-row md:items-center justify-between bg-gray-50 p-4 rounded-lg shadow-sm cursor-pointer hover:bg-gray-100";

        // Create task content container
        const taskContent = document.createElement("div");
        taskContent.className = "flex-grow mb-2 md:mb-0";

        // Create span for the task text
        const taskSpan = document.createElement("span");
        taskSpan.textContent = taskText;
        taskSpan.className = "task-text flex-grow text-gray-700";
        if (isCompleted) {
          taskSpan.classList.add("completed");
        }

        // Create badges container
        const badgesContainer = document.createElement("div");
        badgesContainer.className = "flex flex-wrap gap-2 mt-2 md:mt-0";

        // Create category badge
        const categoryBadge = document.createElement("span");
        categoryBadge.textContent = category.charAt(0).toUpperCase() + category.slice(1);
        categoryBadge.className = `category-badge px-2 py-1 text-xs font-medium rounded-full category-${category}`;
        categoryBadge.dataset.category = category;

        // Create priority badge
        const priorityBadge = document.createElement("span");
        priorityBadge.textContent = priority.charAt(0).toUpperCase() + priority.slice(1);
        priorityBadge.className = `priority-badge px-2 py-1 text-xs font-medium rounded-full priority-${priority}`;
        priorityBadge.dataset.priority = priority;

        // Create due date display if exists
        let dueDateSpan = null;
        if (dueDate) {
          dueDateSpan = document.createElement("span");
          dueDateSpan.textContent = dueDate;
          dueDateSpan.className = "due-date px-2 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded-full";
        }

        // Add badges to container
        badgesContainer.appendChild(categoryBadge);
        badgesContainer.appendChild(priorityBadge);
        if (dueDateSpan) {
          badgesContainer.appendChild(dueDateSpan);
        }

        // Add click event to the list item to toggle completion
        li.addEventListener("click", (event) => {
          // We only toggle if the click is not on the delete button itself or its icon
          if (event.target.closest("button") === null) {
            taskSpan.classList.toggle("completed");
            saveTasks(); // Save after toggling
          }
        });

        // Create delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML = `
                <svg class="w-5 h-5 text-gray-400 hover:text-red-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            `;
        deleteBtn.className = "ml-4 p-1";

        // Add click event to the delete button to remove the task
        deleteBtn.addEventListener("click", () => {
          taskList.removeChild(li);
          saveTasks(); // Save after deleting
        });

        // Append elements to task content
        taskContent.appendChild(taskSpan);
        taskContent.appendChild(badgesContainer);

        // Append the task content and delete button to the list item
        li.appendChild(taskContent);
        li.appendChild(deleteBtn);

        // Append the list item to the task list
        taskList.appendChild(li);
      }

      // Function to handle adding a new task
      function handleAddTask() {
        const taskText = taskInput.value.trim();
        const category = categorySelect.value;
        const priority = prioritySelect.value;
        const dueDate = dueDateInput.value;
        
        if (taskText !== "") {
          createTask(taskText, false, category, priority, dueDate);
          saveTasks(); // Save after adding
          taskInput.value = ""; // Clear the input field
          dueDateInput.value = ""; // Clear the date field
          taskInput.focus(); // Set focus back to the input field
        }
      }

      // Function to load tasks from localStorage
      function loadTasks() {
        // Get tasks from localStorage, or an empty array string if null
        const savedTasks = JSON.parse(
          localStorage.getItem("todoListTasks") || "[]"
        );
        savedTasks.forEach((task) => {
          createTask(task.text, task.completed, task.category, task.priority, task.dueDate);
        });
      }

      // Add event listener for the "Add" button click
      addTaskBtn.addEventListener("click", handleAddTask);

      // Add event listener for the "Enter" key press in the input field
      taskInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          handleAddTask();
        }
      });

      // Load tasks from localStorage when the DOM is fully loaded
      document.addEventListener("DOMContentLoaded", loadTasks);
    </script>
  </body>
</html>