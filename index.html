<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List</title>
    <link rel="icon" type="image/png" href="./assests/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
      /* Custom styles */
      body {
        font-family: "Inter", sans-serif;
        transition: all 0.3s ease-in-out;
      }

      /* Glass morphism effect */
      /* Glass morphism effect */
      .glass {
        background: rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.18) !important;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37) !important;
      }

      .glass-dark {
        background: rgba(0, 0, 0, 0.25) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5) !important;
      }

      .glass-task {
        background: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(8px) !important;
        -webkit-backdrop-filter: blur(8px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
      }

      .glass-task-dark {
        background: rgba(0, 0, 0, 0.2) !important;
        backdrop-filter: blur(8px) !important;
        -webkit-backdrop-filter: blur(8px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      /* Color Themes */
      .theme-blue {
        --primary-color: #3b82f6;
        --primary-hover: #2563eb;
        --bg-color: #f3f4f6;
        --card-bg: #ffffff;
        --text-color: #1f2937;
        --task-bg: #f9fafb;
      }

      .theme-green {
        --primary-color: #10b981;
        --primary-hover: #059669;
        --bg-color: #ecfdf5;
        --card-bg: #ffffff;
        --text-color: #064e3b;
        --task-bg: #f0fdf4;
      }

      .theme-purple {
        --primary-color: #8b5cf6;
        --primary-hover: #7c3aed;
        --bg-color: #faf5ff;
        --card-bg: #ffffff;
        --text-color: #5b21b6;
        --task-bg: #faf5ff;
      }

      .theme-dark {
        --primary-color: #f59e0b;
        --primary-hover: #d97706;
        --bg-color: #1f2937;
        --card-bg: #374151;
        --text-color: #f9fafb;
        --task-bg: #4b5563;
      }

      /* Apply theme variables */
      .theme-blue body {
        background-color: var(--bg-color);
      }

      .theme-blue .card {
        background-color: var(--card-bg);
        color: var(--text-color);
      }

      .theme-blue .task-item {
        background-color: var(--task-bg);
      }

      .theme-blue .btn-primary {
        background-color: var(--primary-color);
      }

      .theme-blue .btn-primary:hover {
        background-color: var(--primary-hover);
      }

      /* Style for completed tasks */
      .completed {
        text-decoration: line-through;
        color: #9ca3af; /* gray-400 */
      }

      /* Animation classes */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(-100%);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes bounce {
        0%,
        20%,
        53%,
        80%,
        100% {
          transform: translate3d(0, 0, 0);
        }
        40%,
        43% {
          transform: translate3d(0, -8px, 0);
        }
        70% {
          transform: translate3d(0, -4px, 0);
        }
        90% {
          transform: translate3d(0, -2px, 0);
        }
      }

      .task-enter {
        animation: slideIn 0.3s ease-out;
      }

      .task-exit {
        animation: fadeOut 0.3s ease-out;
      }

      .pulse-animation {
        animation: pulse 0.5s ease-in-out;
      }

      .bounce-animation {
        animation: bounce 0.6s ease-in-out;
      }

      /* Progress bar styles */
      .progress-bar {
        height: 8px;
        border-radius: 4px;
        background-color: #e5e7eb;
        overflow: hidden;
        transition: width 0.5s ease-in-out;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease-in-out;
      }

      /* Priority badge styles */
      .priority-low {
        background-color: #d1fae5;
        color: #065f46;
      }
      .priority-medium {
        background-color: #fef3c7;
        color: #92400e;
      }
      .priority-high {
        background-color: #fee2e2;
        color: #991b1b;
      }

      /* Category badge styles */
      .category-personal {
        background-color: #dbeafe;
        color: #1e40af;
      }
      .category-work {
        background-color: #f3e8ff;
        color: #6b21a8;
      }
      .category-shopping {
        background-color: #fce7f3;
        color: #9d174d;
      }
      .category-health {
        background-color: #dcfce7;
        color: #166534;
      }

      /* Theme transition */
      .theme-transition {
        transition: all 0.3s ease-in-out;
      }

      /* Body backgrounds with gradients for each theme */
      body.theme-blue {
        background: linear-gradient(
          135deg,
          #93c5fd,
          #3b82f6
        ); /* light blue → blue */
      }
      body.theme-green {
        background: linear-gradient(
          135deg,
          #a7f3d0,
          #10b981
        ); /* light green → green */
      }
      body.theme-purple {
        background: linear-gradient(
          135deg,
          #ddd6fe,
          #8b5cf6
        ); /* light purple → purple */
      }
      body.theme-dark {
        background: linear-gradient(
          135deg,
          #374151,
          #1f2937
        ); /* dark grey → darker grey */
      }

      /* Smooth transition for theme change */
      body {
        transition: background 0.5s ease-in-out;
      }

      /* Glass morphism task items */
      .glass-task {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .glass-task-dark {
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      /* Form elements styling */
      input:not(.task-edit-input):not(.task-edit-category):not(.task-edit-priority):not(.task-edit-date),
      select:not(.task-edit-category):not(.task-edit-priority),
      option,
      ::placeholder {
        color: white !important;
      }

      /* Better contrast for dropdown options */
      select:not(.task-edit-category):not(.task-edit-priority) option {
        background: rgba(0, 0, 0, 0.8);
      }

      /* Edit mode input styling */
      .task-edit-input,
      .task-edit-category,
      .task-edit-priority,
      .task-edit-date {
        background: white !important;
        color: #333 !important;
        border: 1px solid #d1d5db !important;
      }

      .task-edit-input::placeholder,
      .task-edit-date::placeholder {
        color: #9ca3af !important;
      }

      .task-edit-category option,
      .task-edit-priority option {
        background: white !important;
        color: #333 !important;
      }

      /* Interactive Particle Background */
      .particles-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        animation: float 6s ease-in-out infinite;
      }

      .particle:nth-child(odd) {
        animation-duration: 8s;
        animation-delay: -2s;
      }

      .particle:nth-child(3n) {
        animation-duration: 10s;
        animation-delay: -4s;
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px) rotate(0deg);
          opacity: 0.7;
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
          opacity: 1;
        }
      }

      /* Mouse follower particles */
      .mouse-particle {
        position: fixed;
        width: 4px;
        height: 4px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        pointer-events: none;
        z-index: 1000;
        animation: mouseTrail 0.6s ease-out forwards;
      }

      @keyframes mouseTrail {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0);
        }
      }

      /* Confetti Animation */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background: #f39c12;
        animation: confetti-fall 3s linear forwards;
        z-index: 1000;
      }

      .confetti:nth-child(odd) {
        background: #e74c3c;
        animation-delay: 0.1s;
      }

      .confetti:nth-child(3n) {
        background: #3498db;
        animation-delay: 0.2s;
      }

      .confetti:nth-child(4n) {
        background: #2ecc71;
        animation-delay: 0.3s;
      }

      .confetti:nth-child(5n) {
        background: #9b59b6;
        animation-delay: 0.4s;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* Achievement Badge */
      .achievement-badge {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        color: #333;
        padding: 10px 15px;
        border-radius: 25px;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        transform: translateX(100%);
        transition: transform 0.5s ease-in-out;
        z-index: 1000;
        font-weight: bold;
        font-size: 14px;
      }

      .achievement-badge.show {
        transform: translateX(0);
      }

      /* Statistics Panel */
      .stats-panel {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 15px;
        color: white;
        font-size: 12px;
        transform: translateX(-100%);
        transition: transform 0.5s ease-in-out;
        z-index: 1000;
        min-width: 200px;
      }

      .stats-panel.show {
        transform: translateX(0);
      }

      .stats-panel h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        font-weight: bold;
      }

      .stats-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }


      /* Drag and Drop Styles */
      .task-item.dragging {
        opacity: 0.5;
        transform: rotate(5deg);
      }

      .task-item.drag-over {
        border-top: 3px solid #3b82f6;
        transform: translateY(-2px);
      }

      /* Keyboard Shortcuts Help */
      .shortcuts-help {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 8px;
        font-size: 12px;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .shortcuts-help.show {
        opacity: 1;
      }

      /* Export/Import Panel */
      .export-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 20px;
        z-index: 1000;
        min-width: 300px;
        display: none;
      }

      .export-panel.show {
        display: block;
      }

      .export-panel h3 {
        margin: 0 0 15px 0;
        color: #333;
      }

      .export-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .export-btn {
        flex: 1;
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.3s;
      }

      .export-btn.export {
        background: #3b82f6;
        color: white;
      }

      .export-btn.import {
        background: #10b981;
        color: white;
      }

      .export-btn:hover {
        opacity: 0.8;
      }

      .close-panel {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #666;
      }

      /* Enhanced animations */
      @keyframes glow {
        0%, 100% {
          box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
        }
        50% {
          box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }
      }

      .glow-animation {
        animation: glow 2s ease-in-out infinite;
      }

      /* Sound wave animation for audio feedback */
      .sound-wave {
        position: fixed;
        bottom: 50%;
        right: 50%;
        width: 4px;
        height: 4px;
        background: rgba(59, 130, 246, 0.8);
        border-radius: 50%;
        animation: soundWave 0.5s ease-out forwards;
        z-index: 1000;
      }

      @keyframes soundWave {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        100% {
          transform: scale(20);
          opacity: 0;
        }
      }

      /* Layout fixes */
      .card {
        max-height: 90vh;
        overflow-y: auto;
      }

      /* Ensure proper spacing on mobile */
      @media (max-width: 768px) {
        .card {
          margin: 1rem;
          padding: 1rem;
        }
        
        .flex.items-center.gap-2 {
          gap: 0.5rem;
        }
        
        .text-3xl {
          font-size: 1.875rem;
        }
      }

      /* Fix button sizing on mobile */
      @media (max-width: 640px) {
        .p-2 {
          padding: 0.375rem;
        }
        
        .w-5.h-5 {
          width: 1rem;
          height: 1rem;
        }
      }
    </style>
  </head>
  <body
    class="theme-blue bg-gray-100 flex items-center justify-center min-h-screen theme-transition"
  >
    <!-- Interactive Particle Background -->
    <div class="particles-container" id="particlesContainer"></div>
    
    <!-- Achievement Badge -->
    <div class="achievement-badge" id="achievementBadge">
      🏆 Achievement Unlocked!
    </div>
    
    <!-- Statistics Panel -->
    <div class="stats-panel" id="statsPanel">
      <h3>📊 Your Stats</h3>
      <div class="stats-item">
        <span>Tasks Completed:</span>
        <span id="statsCompleted">0</span>
      </div>
      <div class="stats-item">
        <span>Productivity Score:</span>
        <span id="statsScore">0%</span>
      </div>
      <div class="stats-item">
        <span>Streak:</span>
        <span id="statsStreak">0 days</span>
      </div>
    </div>
    
    
    <!-- Keyboard Shortcuts Help -->
    <div class="shortcuts-help" id="shortcutsHelp">
      <strong>Keyboard Shortcuts:</strong><br>
      Ctrl+N: New Task<br>
      Ctrl+F: Focus Search<br>
      Ctrl+S: Show Stats<br>
      Ctrl+E: Export/Import<br>
      ?: Show/Hide Help
    </div>
    
    <!-- Export/Import Panel -->
    <div class="export-panel" id="exportPanel">
      <button class="close-panel" id="closeExportPanel">×</button>
      <h3>Export/Import Tasks</h3>
      <div class="export-buttons">
        <button class="export-btn export" id="exportTasks">Export JSON</button>
        <button class="export-btn import" id="importTasks">Import JSON</button>
      </div>
      <input type="file" id="importFile" accept=".json" style="display: none;">
      <p style="font-size: 12px; color: #666; margin: 0;">
        Export your tasks as JSON or import from a file
      </p>
    </div>

    <div
      class="card glass rounded-lg shadow-xl w-full max-w-3xl mx-4 p-6 theme-transition"
    >
      <!-- Header -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h1 class="text-3xl font-bold text-gray-500">To-Do List</h1>
          
          <!-- Desktop Controls -->
          <div class="hidden md:flex items-center gap-2">
            <!-- Stats Toggle -->
            <button
              id="statsToggle"
              class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
              title="Show Statistics"
            >
              <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </button>
            
            <!-- Export/Import Toggle -->
            <button
              id="exportToggle"
              class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
              title="Export/Import Tasks"
            >
              <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
              </svg>
            </button>
            
            <!-- Theme Toggle -->
            <div class="relative">
              <button
                id="themeToggle"
                class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
                title="Change Theme"
              >
                <svg
                  class="w-5 h-5 text-gray-700"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"
                  ></path>
                </svg>
              </button>
              <div
                id="themeDropdown"
                class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-10"
              >
                <button
                  data-theme="blue"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-blue-500 mr-3"></div>
                  Blue Theme
                </button>
                <button
                  data-theme="green"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-green-500 mr-3"></div>
                  Green Theme
                </button>
                <button
                  data-theme="purple"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-purple-500 mr-3"></div>
                  Purple Theme
                </button>
                <button
                  data-theme="dark"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-gray-800 mr-3"></div>
                  Dark Theme
                </button>
              </div>
            </div>
          </div>
          
          <!-- Mobile Controls -->
          <div class="md:hidden flex items-center gap-2">
            <button
              id="mobileStatsToggle"
              class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
              title="Show Statistics"
            >
              <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </button>
            
            <button
              id="mobileExportToggle"
              class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
              title="Export/Import Tasks"
            >
              <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
              </svg>
            </button>
            
            <div class="relative">
              <button
                id="mobileThemeToggle"
                class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
                title="Change Theme"
              >
                <svg
                  class="w-5 h-5 text-gray-700"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"
                  ></path>
                </svg>
              </button>
              <div
                id="mobileThemeDropdown"
                class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-10"
              >
                <button
                  data-theme="blue"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-blue-500 mr-3"></div>
                  Blue Theme
                </button>
                <button
                  data-theme="green"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-green-500 mr-3"></div>
                  Green Theme
                </button>
                <button
                  data-theme="purple"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-purple-500 mr-3"></div>
                  Purple Theme
                </button>
                <button
                  data-theme="dark"
                  class="theme-option flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <div class="w-4 h-4 rounded-full bg-gray-800 mr-3"></div>
                  Dark Theme
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">
            <span id="completedCount">0</span> of
            <span id="totalCount">0</span> tasks completed
          </div>
          <div class="w-32 progress-bar">
            <div
              id="progressFill"
              class="progress-fill bg-blue-500"
              style="width: 0%"
            ></div>
          </div>
        </div>
      </div>

      <div class="mb-6 space-y-4">
        <div class="flex gap-3">
          <input
            type="text"
            id="taskInput"
            class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition glass-task "
            placeholder="Add a new task..."
          />
          <button
            id="addTaskBtn"
            class="btn-primary bg-blue-500 text-white font-semibold px-5 py-3 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition shadow-md hover:shadow-lg bounce-animation"
          >
            Add Task
          </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-500 mb-1"
              >Category</label
            >
            <select
              id="categorySelect"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition glass-task"
            >
              <option value="personal">Personal</option>
              <option value="work">Work</option>
              <option value="shopping">Shopping</option>
              <option value="health">Health</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-500 mb-1"
              >Priority</label
            >
            <select
              id="prioritySelect"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition glass-task"
            >
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-500 mb-1"
              >Due Date</label
            >
            <input
              type="text"
              id="dueDateInput"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition glass-task"
              placeholder="Select date"
            />
          </div>
        </div>
      </div>

      <!-- SEARCH (NEW) -->
      <div class="mb-4">
        <input
          id="searchInput"
          type="text"
          placeholder="Search tasks, category, priority or date..."
          class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition glass-task"
        />
      </div>


      <div>
        <ul id="taskList" class="space-y-3"></ul>

        <div id="noResults" class="text-center py-8 hidden">
          <svg class="w-16 h-16 text-gray-300 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"></path>
          </svg>
          <p class="text-gray-500 text-lg">No matching tasks</p>
        </div>

        <div id="emptyState" class="text-center py-12 hidden">
          <svg
            class="w-24 h-24 text-gray-300 mx-auto mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            ></path>
          </svg>
          <p class="text-gray-500 text-lg">No tasks yet. Add one above!</p>
        </div>
      </div>
    </div>

    <script>
      // Get references to the HTML elements
      const taskInput = document.getElementById("taskInput");
      const addTaskBtn = document.getElementById("addTaskBtn");
      const taskList = document.getElementById("taskList");
      const categorySelect = document.getElementById("categorySelect");
      const prioritySelect = document.getElementById("prioritySelect");
      const dueDateInput = document.getElementById("dueDateInput");
      const themeToggle = document.getElementById("themeToggle");
      const themeDropdown = document.getElementById("themeDropdown");
      const progressFill = document.getElementById("progressFill");
      const completedCount = document.getElementById("completedCount");
      const totalCount = document.getElementById("totalCount");
      const emptyState = document.getElementById("emptyState");

      // Search related elements (new)
      const searchInput = document.getElementById("searchInput");
      const noResults = document.getElementById("noResults");

      // Initialize flatpickr for date selection
      flatpickr(dueDateInput, {
        dateFormat: "Y-m-d",
        minDate: "today",
      });

      // Current theme state
      let currentTheme = localStorage.getItem("todoTheme") || "blue";

      // Apply saved theme on load
      document.addEventListener("DOMContentLoaded", function () {
        applyTheme(currentTheme);
        loadTasks();
        updateProgress();

        // Add animation to add button on page load
        addTaskBtn.classList.add("bounce-animation");
        setTimeout(() => {
          addTaskBtn.classList.remove("bounce-animation");
        }, 600);
      });

      // Theme functionality
      themeToggle.addEventListener("click", function () {
        themeDropdown.classList.toggle("hidden");
      });

      document.querySelectorAll(".theme-option").forEach((option) => {
        option.addEventListener("click", function () {
          const theme = this.dataset.theme;
          applyTheme(theme);
          document.getElementById("themeDropdown").classList.add("hidden");
          document.getElementById("mobileThemeDropdown").classList.add("hidden");
        });
      });

      function applyTheme(theme) {
        currentTheme = theme;
        document.body.className = `theme-${theme} bg-gray-100 flex items-center justify-center min-h-screen theme-transition`;
        localStorage.setItem("todoTheme", theme);

        // Update glass morphism based on theme
        const card = document.querySelector(".card");
        if (theme === "dark") {
          card.classList.remove("glass");
          card.classList.add("glass-dark");
        } else {
          card.classList.remove("glass-dark");
          card.classList.add("glass");
        }

        // Update progress bar color based on theme
        const progressBars = document.querySelectorAll(".progress-fill");
        progressBars.forEach((bar) => {
          bar.className = `progress-fill bg-${getThemeColor(theme)}-500`;
        });

        // Update button colors
        const primaryButtons = document.querySelectorAll(".btn-primary");
        primaryButtons.forEach((btn) => {
          btn.className = btn.className.replace(
            /bg-(blue|green|purple|yellow)-\d+/,
            `bg-${getThemeColor(theme)}-500`
          );
          btn.className = btn.className.replace(
            /hover:bg-(blue|green|purple|yellow)-\d+/,
            `hover:bg-${getThemeColor(theme)}-600`
          );
          btn.className = btn.className.replace(
            /focus:ring-(blue|green|purple|yellow)-\d+/,
            `focus:ring-${getThemeColor(theme)}-500`
          );
        });

        // Update task items glass effect
        const taskItems = document.querySelectorAll(".task-item");
        taskItems.forEach((item) => {
          if (theme === "dark") {
            item.classList.remove("glass-task");
            item.classList.add("glass-task-dark");
          } else {
            item.classList.remove("glass-task-dark");
            item.classList.add("glass-task");
          }
        });

        // Update input fields glass effect
        const glassElements = document.querySelectorAll(".glass-task");
        glassElements.forEach((element) => {
          if (theme === "dark") {
            element.classList.remove("glass-task");
            element.classList.add("glass-task-dark");
          } else {
            element.classList.remove("glass-task-dark");
            element.classList.add("glass-task");
          }
        });
      }

      function getThemeColor(theme) {
        const colorMap = {
          blue: "blue",
          green: "green",
          purple: "purple",
          dark: "yellow",
        };
        return colorMap[theme] || "blue";
      }

      // Progress tracking
      function updateProgress() {
        const totalTasks = taskList.children.length;
        const completedTasks = document.querySelectorAll(
          ".task-text.completed"
        ).length;
        const progress =
          totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

        progressFill.style.width = `${progress}%`;
        completedCount.textContent = completedTasks;
        totalCount.textContent = totalTasks;

        // Show/hide empty state
        if (totalTasks === 0) {
          emptyState.classList.remove("hidden");
        } else {
          emptyState.classList.add("hidden");
        }

        // Pulse animation when progress changes
        if (progress > 0) {
          progressFill.classList.add("pulse-animation");
          setTimeout(() => {
            progressFill.classList.remove("pulse-animation");
          }, 500);
        }

        // If user has a search query active, re-run filter so UI stays consistent
        if (searchInput && searchInput.value.trim() !== "") {
          runSearchFilter(searchInput.value.trim());
        } else {
          // when no search text, ensure no-results hidden
          if (noResults) noResults.classList.add("hidden");
        }
      }

      // Function to save all tasks to localStorage
      function saveTasks() {
        const tasks = [];
        // Select all list items in the task list
        taskList.querySelectorAll("li").forEach((li) => {
          const taskSpan = li.querySelector(".task-text");
          const categoryBadge = li.querySelector(".category-badge");
          const priorityBadge = li.querySelector(".priority-badge");
          const dueDateSpan = li.querySelector(".due-date");

          if (taskSpan) {
            tasks.push({
              text: taskSpan.textContent,
              completed: taskSpan.classList.contains("completed"),
              category: categoryBadge
                ? categoryBadge.dataset.category
                : "personal",
              priority: priorityBadge
                ? priorityBadge.dataset.priority
                : "medium",
              dueDate: dueDateSpan ? dueDateSpan.textContent : "",
            });
          }
        });
        // Store the array as a JSON string
        localStorage.setItem("todoListTasks", JSON.stringify(tasks));
        updateProgress();
      }

      // Function to create a new task item
      function createTask(
        taskText,
        isCompleted = false,
        category = "personal",
        priority = "medium",
        dueDate = ""
      ) {
        // Create list item
        const li = document.createElement("li");
        li.className =
          "task-item flex flex-col md:flex-row md:items-center justify-between p-4 rounded-lg shadow-sm cursor-pointer hover:bg-opacity-70 task-enter theme-transition glass-task";

        // Create task content container
        const taskContent = document.createElement("div");
        taskContent.className = "flex-grow mb-2 md:mb-0";

        // Create span for the task text
        const taskSpan = document.createElement("span");
        taskSpan.textContent = taskText;
        taskSpan.className =
          "task-text flex-grow text-gray-700 transition-all duration-300";
        if (isCompleted) {
          taskSpan.classList.add("completed");
        }

        // Create badges container
        const badgesContainer = document.createElement("div");
        badgesContainer.className = "flex flex-wrap gap-2 mt-2 md:mt-0";

        // Create category badge
        const categoryBadge = document.createElement("span");
        categoryBadge.textContent =
          category.charAt(0).toUpperCase() + category.slice(1);
        categoryBadge.className = `category-badge px-2 py-1 text-xs font-medium rounded-full category-${category} transition-transform hover:scale-105`;
        categoryBadge.dataset.category = category;

        // Create priority badge
        const priorityBadge = document.createElement("span");
        priorityBadge.textContent =
          priority.charAt(0).toUpperCase() + priority.slice(1);
        priorityBadge.className = `priority-badge px-2 py-1 text-xs font-medium rounded-full priority-${priority} transition-transform hover:scale-105`;
        priorityBadge.dataset.priority = priority;

        // Create due date display if exists
        let dueDateSpan = null;
        if (dueDate) {
          dueDateSpan = document.createElement("span");
          dueDateSpan.textContent = dueDate;
          dueDateSpan.className =
            "due-date px-2 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded-full transition-transform hover:scale-105";
        }

        // Add badges to container
        badgesContainer.appendChild(categoryBadge);
        badgesContainer.appendChild(priorityBadge);
        if (dueDateSpan) {
          badgesContainer.appendChild(dueDateSpan);
        }

        // Add click event to the list item to toggle completion
        li.addEventListener("click", (event) => {
          // Only toggle completion if not in edit mode and not clicking a button
          if (
            !li.classList.contains("editing") &&
            event.target.closest("button") === null
          ) {
            taskSpan.classList.toggle("completed");
            taskSpan.classList.add("pulse-animation");
            setTimeout(() => {
              taskSpan.classList.remove("pulse-animation");
            }, 500);
            saveTasks(); // Save after toggling
            updateProgress(); // Update progress immediately
          }
        });

        // Create delete button
        const editBtn = document.createElement("button");
        editBtn.innerHTML = `<svg class="w-5 h-5 text-gray-400 hover:text-blue-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>`;
        editBtn.className = "p-1 transition-transform hover:scale-110 edit-btn";
        editBtn.addEventListener("click", (e) => {
          e.stopPropagation(); // Prevent li click event from firing
          toggleEditMode(li);
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML = `
                <svg class="w-5 h-5 text-gray-400 hover:text-red-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            `;
        deleteBtn.className =
          "p-1 transition-transform hover:scale-110 delete-btn";

        // Add click event to the delete button to remove the task
        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation(); // Prevent li click event from firing
          li.classList.add("task-exit");
          setTimeout(() => {
            if (li.parentNode) {
              taskList.removeChild(li);
              saveTasks(); // Save after deleting
              updateProgress(); // Update progress immediately
            }
          }, 300);
        });

        const buttonsContainer = document.createElement("div");
        buttonsContainer.className = "flex items-center space-x-2 ml-4";
        buttonsContainer.appendChild(editBtn);
        buttonsContainer.appendChild(deleteBtn);
        // Append elements to task content
        taskContent.appendChild(taskSpan);
        taskContent.appendChild(badgesContainer);

        // Append the task content and delete button to the list item
        li.appendChild(taskContent);
        li.appendChild(buttonsContainer);

        // Append the list item to the task list
        taskList.appendChild(li);

        // Apply theme-specific glass effect to the new task
        if (currentTheme === "dark") {
          li.classList.remove("glass-task");
          li.classList.add("glass-task-dark");
        }

        // Make the new task draggable
        makeTaskDraggable(li);

        // Add bounce animation to new task
        setTimeout(() => {
          li.classList.remove("task-enter");
        }, 300);

        // If there's an active search query, re-run filter so new item respects it
        if (searchInput && searchInput.value.trim() !== "") {
          runSearchFilter(searchInput.value.trim());
        }

        // Update progress immediately after adding task
        updateProgress();
      }

      // Function to toggle edit mode for a task
      function toggleEditMode(li) {
        li.classList.toggle("editing");
        const isEditing = li.classList.contains("editing");

        const taskContent = li.querySelector(".flex-grow");
        const buttonsContainer = li.querySelector(
          ".flex.items-center.space-x-2"
        );
        const editBtn = buttonsContainer.querySelector(".edit-btn");

        if (isEditing) {
          // Switch to edit mode
          const taskSpan = li.querySelector(".task-text");
          const categoryBadge = li.querySelector(".category-badge");
          const priorityBadge = li.querySelector(".priority-badge");
          const dueDateSpan = li.querySelector(".due-date");

          // Create input fields pre-filled with current values
          const textInput = document.createElement("input");
          textInput.type = "text";
          textInput.value = taskSpan.textContent;
          textInput.className =
            "task-edit-input flex-grow p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500";

          const categoryEditSelect = categorySelect.cloneNode(true);
          categoryEditSelect.value = categoryBadge.dataset.category;
          categoryEditSelect.className =
            "task-edit-category w-full p-2 border border-gray-300 rounded-lg";

          const priorityEditSelect = prioritySelect.cloneNode(true);
          priorityEditSelect.value = priorityBadge.dataset.priority;
          priorityEditSelect.className =
            "task-edit-priority w-full p-2 border border-gray-300 rounded-lg";

          const dateEditInput = document.createElement("input");
          dateEditInput.type = "text";
          dateEditInput.value = dueDateSpan ? dueDateSpan.textContent : "";
          dateEditInput.className =
            "task-edit-date w-full p-2 border border-gray-300 rounded-lg";
          flatpickr(dateEditInput, { dateFormat: "Y-m-d", minDate: "today" });

          // Replace display elements with inputs
          taskContent.innerHTML = ""; // Clear existing content
          taskContent.appendChild(textInput);
          const editFields = document.createElement("div");
          editFields.className = "grid grid-cols-1 md:grid-cols-3 gap-2 mt-2";
          editFields.appendChild(categoryEditSelect);
          editFields.appendChild(priorityEditSelect);
          editFields.appendChild(dateEditInput);
          taskContent.appendChild(editFields);

          // Change edit button to a save button
          editBtn.innerHTML = `<svg class="w-5 h-5 text-gray-400 hover:text-green-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
        } else {
          // Switch back to display mode (Save was clicked)
          const textInput = li.querySelector(".task-edit-input");
          const categoryEditSelect = li.querySelector(".task-edit-category");
          const priorityEditSelect = li.querySelector(".task-edit-priority");
          const dateEditInput = li.querySelector(".task-edit-date");

          if (textInput.value.trim() === "") {
            alert("Task text cannot be empty.");
            li.classList.add("editing"); // Stay in edit mode
            return;
          }

          // Recreate the task with updated values to ensure consistency
          const isCompleted =
            li.querySelector(".task-text")?.classList.contains("completed") ||
            false;
          const updatedTask = {
            text: textInput.value.trim(),
            completed: isCompleted,
            category: categoryEditSelect.value,
            priority: priorityEditSelect.value,
            dueDate: dateEditInput.value,
          };

          // To keep the task in the same position, we can find its index and insert the new one there.
          const taskIndex = Array.from(taskList.children).indexOf(li);
          taskList.removeChild(li);
          createTask(
            updatedTask.text,
            updatedTask.completed,
            updatedTask.category,
            updatedTask.priority,
            updatedTask.dueDate
          );
          taskList.insertBefore(
            taskList.lastChild,
            taskList.children[taskIndex]
          );
          saveTasks();
        }
      }

      // Function to handle adding a new task
      function handleAddTask() {
        const taskText = taskInput.value.trim();
        const category = categorySelect.value;
        const priority = prioritySelect.value;
        const dueDate = dueDateInput.value;

        if (taskText !== "") {
          createTask(taskText, false, category, priority, dueDate);
          saveTasks(); // Save after adding
          
          // Clear all input fields
          taskInput.value = ""; // Clear the task input field
          dueDateInput.value = ""; // Clear the date field
          categorySelect.value = "personal"; // Reset category to default
          prioritySelect.value = "medium"; // Reset priority to default
          
          // Clear search if active to show the new task
          if (searchInput && searchInput.value.trim() !== "") {
            searchInput.value = "";
            runSearchFilter(""); // Show all tasks
          }
          
          // Add visual feedback for cleared fields
          taskInput.classList.add("pulse-animation");
          setTimeout(() => {
            taskInput.classList.remove("pulse-animation");
          }, 500);
          
          taskInput.focus(); // Set focus back to the input field

          // Add bounce animation to add button
          addTaskBtn.classList.add("bounce-animation");
          setTimeout(() => {
            addTaskBtn.classList.remove("bounce-animation");
          }, 600);
        }
      }

      // Function to load tasks from localStorage
      function loadTasks() {
        // Get tasks from localStorage, or an empty array string if null
        const savedTasks = JSON.parse(
          localStorage.getItem("todoListTasks") || "[]"
        );
        savedTasks.forEach((task) => {
          createTask(
            task.text,
            task.completed,
            task.category,
            task.priority,
            task.dueDate
          );
        });
      }

      // Add event listener for the "Add" button click
      addTaskBtn.addEventListener("click", handleAddTask);

      // Add event listener for the "Enter" key press in the input field
      taskInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          handleAddTask();
        }
      });

      // Live search/filter implementation (NEW)
      function runSearchFilter(query) {
        const q = String(query || "").trim().toLowerCase();
        let visibleCount = 0;
        // If no tasks at all, keep original emptyState logic (don't show noResults)
        const totalTasks = taskList.children.length;

        Array.from(taskList.children).forEach((li) => {
          // search in task text, category, priority, due date
          const taskTextEl = li.querySelector(".task-text");
          const categoryEl = li.querySelector(".category-badge");
          const priorityEl = li.querySelector(".priority-badge");
          const dueEl = li.querySelector(".due-date");

          const haystackParts = [];
          if (taskTextEl) haystackParts.push(taskTextEl.textContent);
          if (categoryEl) haystackParts.push(categoryEl.textContent);
          if (priorityEl) haystackParts.push(priorityEl.textContent);
          if (dueEl) haystackParts.push(dueEl.textContent);

          const haystack = haystackParts.join(" ").toLowerCase();

          const matches = q === "" || haystack.indexOf(q) !== -1;

          if (matches) {
            li.style.display = "";
            visibleCount++;
          } else {
            li.style.display = "none";
          }
        });

        // If there are zero tasks in list -> show original emptyState (unchanged)
        if (totalTasks === 0) {
          if (emptyState) emptyState.classList.remove("hidden");
          if (noResults) noResults.classList.add("hidden");
          return;
        } else {
          if (emptyState) emptyState.classList.add("hidden");
        }

        // If no visible tasks after filtering, show the "noResults" message
        if (visibleCount === 0 && q !== "") {
          if (noResults) noResults.classList.remove("hidden");
        } else {
          if (noResults) noResults.classList.add("hidden");
        }
      }

      // Attach input listener
      if (searchInput) {
        searchInput.addEventListener("input", (e) => {
          runSearchFilter(e.target.value);
        });
      }

      // Close theme dropdowns when clicking outside
      document.addEventListener("click", function (event) {
        const themeToggle = document.getElementById("themeToggle");
        const themeDropdown = document.getElementById("themeDropdown");
        const mobileThemeToggle = document.getElementById("mobileThemeToggle");
        const mobileThemeDropdown = document.getElementById("mobileThemeDropdown");
        
        if (
          !themeToggle.contains(event.target) &&
          !themeDropdown.contains(event.target)
        ) {
          themeDropdown.classList.add("hidden");
        }
        
        if (
          !mobileThemeToggle.contains(event.target) &&
          !mobileThemeDropdown.contains(event.target)
        ) {
          mobileThemeDropdown.classList.add("hidden");
        }
      });

      // ===== NEW AMAZING FEATURES =====

      // Interactive Particle Background
      function createParticles() {
        const container = document.getElementById('particlesContainer');
        const particleCount = 50;
        
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          
          // Random size and position
          const size = Math.random() * 4 + 2;
          particle.style.width = size + 'px';
          particle.style.height = size + 'px';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.top = Math.random() * 100 + '%';
          
          // Random color based on theme
          const colors = currentTheme === 'dark' 
            ? ['rgba(255,255,255,0.3)', 'rgba(255,255,255,0.5)', 'rgba(255,255,255,0.2)']
            : ['rgba(59,130,246,0.3)', 'rgba(16,185,129,0.3)', 'rgba(139,92,246,0.3)'];
          particle.style.background = colors[Math.floor(Math.random() * colors.length)];
          
          // Random animation delay
          particle.style.animationDelay = Math.random() * 6 + 's';
          
          container.appendChild(particle);
        }
      }

      // Mouse trail effect
      let mouseTrailTimeout;
      document.addEventListener('mousemove', function(e) {
        clearTimeout(mouseTrailTimeout);
        
        const trail = document.createElement('div');
        trail.className = 'mouse-particle';
        trail.style.left = e.clientX + 'px';
        trail.style.top = e.clientY + 'px';
        
        document.body.appendChild(trail);
        
        setTimeout(() => {
          if (trail.parentNode) {
            trail.parentNode.removeChild(trail);
          }
        }, 600);
        
        mouseTrailTimeout = setTimeout(() => {
          // Clean up any remaining trails
          document.querySelectorAll('.mouse-particle').forEach(t => {
            if (t.parentNode) t.parentNode.removeChild(t);
          });
        }, 1000);
      });

      // Sound Effects (using Web Audio API)
      function playSound(type) {
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          let frequency;
          switch(type) {
            case 'complete': frequency = 800; break;
            case 'delete': frequency = 200; break;
            case 'add': frequency = 600; break;
            case 'theme': frequency = 400; break;
            default: frequency = 500;
          }
          
          oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
          
          // Visual sound wave effect
          createSoundWave();
        } catch (e) {
          console.log('Audio not supported');
        }
      }

      function createSoundWave() {
        const wave = document.createElement('div');
        wave.className = 'sound-wave';
        document.body.appendChild(wave);
        
        setTimeout(() => {
          if (wave.parentNode) {
            wave.parentNode.removeChild(wave);
          }
        }, 500);
      }

      // Confetti Animation
      function createConfetti() {
        const colors = ['#f39c12', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6'];
        const confettiCount = 50;
        
        for (let i = 0; i < confettiCount; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 2 + 's';
          
          document.body.appendChild(confetti);
          
          setTimeout(() => {
            if (confetti.parentNode) {
              confetti.parentNode.removeChild(confetti);
            }
          }, 5000);
        }
      }

      // Achievement System
      let achievements = JSON.parse(localStorage.getItem('achievements') || '[]');
      let stats = JSON.parse(localStorage.getItem('userStats') || '{"completed": 0, "streak": 0}');

      function checkAchievements() {
        const totalTasks = taskList.children.length;
        const completedTasks = document.querySelectorAll('.task-text.completed').length;
        
        const newAchievements = [];
        
        if (completedTasks >= 1 && !achievements.includes('first_task')) {
          newAchievements.push({id: 'first_task', text: '🎉 First Task Completed!'});
        }
        if (completedTasks >= 10 && !achievements.includes('ten_tasks')) {
          newAchievements.push({id: 'ten_tasks', text: '🔥 10 Tasks Completed!'});
        }
        if (completedTasks >= 50 && !achievements.includes('fifty_tasks')) {
          newAchievements.push({id: 'fifty_tasks', text: '🏆 50 Tasks Completed!'});
        }
        if (totalTasks > 0 && completedTasks === totalTasks && !achievements.includes('all_done')) {
          newAchievements.push({id: 'all_done', text: '🎊 All Tasks Completed!'});
          createConfetti();
        }
        
        newAchievements.forEach(achievement => {
          achievements.push(achievement.id);
          showAchievement(achievement.text);
        });
        
        localStorage.setItem('achievements', JSON.stringify(achievements));
      }

      function showAchievement(text) {
        const badge = document.getElementById('achievementBadge');
        badge.textContent = text;
        badge.classList.add('show');
        
        setTimeout(() => {
          badge.classList.remove('show');
        }, 3000);
      }

      // Statistics System
      function updateStats() {
        const completedTasks = document.querySelectorAll('.task-text.completed').length;
        const totalTasks = taskList.children.length;
        const productivityScore = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        stats.completed = completedTasks;
        stats.productivityScore = productivityScore;
        
        // Update streak (simplified - increments daily)
        const today = new Date().toDateString();
        const lastActive = localStorage.getItem('lastActive');
        if (lastActive !== today) {
          if (completedTasks > 0) {
            stats.streak++;
          } else {
            stats.streak = 0;
          }
          localStorage.setItem('lastActive', today);
        }
        
        localStorage.setItem('userStats', JSON.stringify(stats));
        
        // Update UI
        document.getElementById('statsCompleted').textContent = completedTasks;
        document.getElementById('statsScore').textContent = productivityScore + '%';
        document.getElementById('statsStreak').textContent = stats.streak + ' days';
      }


      // Drag and Drop
      let draggedElement = null;

      function makeTaskDraggable(li) {
        li.draggable = true;
        
        li.addEventListener('dragstart', (e) => {
          draggedElement = li;
          li.classList.add('dragging');
        });
        
        li.addEventListener('dragend', () => {
          li.classList.remove('dragging');
          draggedElement = null;
        });
        
        li.addEventListener('dragover', (e) => {
          e.preventDefault();
          li.classList.add('drag-over');
        });
        
        li.addEventListener('dragleave', () => {
          li.classList.remove('drag-over');
        });
        
        li.addEventListener('drop', (e) => {
          e.preventDefault();
          li.classList.remove('drag-over');
          
          if (draggedElement && draggedElement !== li) {
            const rect = li.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            
            if (e.clientY < midpoint) {
              taskList.insertBefore(draggedElement, li);
            } else {
              taskList.insertBefore(draggedElement, li.nextSibling);
            }
            
            saveTasks();
          }
        });
      }

      // Keyboard Shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'n':
              e.preventDefault();
              taskInput.focus();
              break;
            case 'f':
              e.preventDefault();
              searchInput.focus();
              break;
            case 's':
              e.preventDefault();
              toggleStats();
              break;
            case 'e':
              e.preventDefault();
              toggleExport();
              break;
          }
        }
        
        if (e.key === '?') {
          e.preventDefault();
          toggleShortcutsHelp();
        }
      });

      // Export/Import Functions
      function exportTasks() {
        const tasks = [];
        taskList.querySelectorAll('li').forEach(li => {
          const taskSpan = li.querySelector('.task-text');
          const categoryBadge = li.querySelector('.category-badge');
          const priorityBadge = li.querySelector('.priority-badge');
          const dueDateSpan = li.querySelector('.due-date');
          
          if (taskSpan) {
            tasks.push({
              text: taskSpan.textContent,
              completed: taskSpan.classList.contains('completed'),
              category: categoryBadge ? categoryBadge.dataset.category : 'personal',
              priority: priorityBadge ? priorityBadge.dataset.priority : 'medium',
              dueDate: dueDateSpan ? dueDateSpan.textContent : ''
            });
          }
        });
        
        const dataStr = JSON.stringify(tasks, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = 'todo-tasks.json';
        link.click();
        
        URL.revokeObjectURL(url);
      }

      function importTasks() {
        document.getElementById('importFile').click();
      }

      // Toggle Functions
      function toggleStats() {
        const panel = document.getElementById('statsPanel');
        panel.classList.toggle('show');
        updateStats();
      }


      function toggleExport() {
        const panel = document.getElementById('exportPanel');
        panel.classList.toggle('show');
      }

      function toggleShortcutsHelp() {
        const help = document.getElementById('shortcutsHelp');
        help.classList.toggle('show');
      }

      // Event Listeners for new features
      document.getElementById('statsToggle').addEventListener('click', toggleStats);
      document.getElementById('exportToggle').addEventListener('click', toggleExport);
      
      // Mobile control event listeners
      document.getElementById('mobileStatsToggle').addEventListener('click', toggleStats);
      document.getElementById('mobileExportToggle').addEventListener('click', toggleExport);
      document.getElementById('mobileThemeToggle').addEventListener('click', function() {
        document.getElementById('mobileThemeDropdown').classList.toggle('hidden');
      });
      document.getElementById('exportTasks').addEventListener('click', exportTasks);
      document.getElementById('importTasks').addEventListener('click', importTasks);
      document.getElementById('closeExportPanel').addEventListener('click', () => {
        document.getElementById('exportPanel').classList.remove('show');
      });

      document.getElementById('importFile').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const tasks = JSON.parse(e.target.result);
              taskList.innerHTML = '';
              tasks.forEach(task => {
                createTask(task.text, task.completed, task.category, task.priority, task.dueDate);
              });
              saveTasks();
              showAchievement('📁 Tasks Imported Successfully!');
            } catch (error) {
              alert('Error importing tasks. Please check the file format.');
            }
          };
          reader.readAsText(file);
        }
      });

      // Enhanced task creation with drag and drop
      const originalCreateTask = createTask;
      createTask = function(...args) {
        const result = originalCreateTask.apply(this, args);
        return result;
      };

      // Enhanced progress update with achievements and stats
      const originalUpdateProgress = updateProgress;
      updateProgress = function() {
        // Call the original function first
        const totalTasks = taskList.children.length;
        const completedTasks = document.querySelectorAll(
          ".task-text.completed"
        ).length;
        const progress =
          totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

        progressFill.style.width = `${progress}%`;
        completedCount.textContent = completedTasks;
        totalCount.textContent = totalTasks;

        // Show/hide empty state
        if (totalTasks === 0) {
          emptyState.classList.remove("hidden");
        } else {
          emptyState.classList.add("hidden");
        }

        // Pulse animation when progress changes
        if (progress > 0) {
          progressFill.classList.add("pulse-animation");
          setTimeout(() => {
            progressFill.classList.remove("pulse-animation");
          }, 500);
        }

        // If user has a search query active, re-run filter so UI stays consistent
        if (searchInput && searchInput.value.trim() !== "") {
          runSearchFilter(searchInput.value.trim());
        } else {
          // when no search text, ensure no-results hidden
          if (noResults) noResults.classList.add("hidden");
        }
        
        // Then call the new features
        checkAchievements();
        updateStats();
      };

      // Enhanced task completion with sound
      const originalTaskClick = taskList.addEventListener;
      taskList.addEventListener('click', (e) => {
        if (e.target.classList.contains('task-text')) {
          const wasCompleted = e.target.classList.contains('completed');
          setTimeout(() => {
            const isCompleted = e.target.classList.contains('completed');
            if (isCompleted && !wasCompleted) {
              playSound('complete');
            }
          }, 100);
        }
      });

      // Enhanced task deletion with sound
      document.addEventListener('click', (e) => {
        if (e.target.closest('.delete-btn')) {
          playSound('delete');
        }
      });

      // Enhanced theme change with sound
      const originalApplyTheme = applyTheme;
      applyTheme = function(theme) {
        originalApplyTheme.apply(this, arguments);
        playSound('theme');
        // Update particles when theme changes
        document.getElementById('particlesContainer').innerHTML = '';
        createParticles();
      };

      // Enhanced add task with sound
      const originalHandleAddTask = handleAddTask;
      handleAddTask = function() {
        const result = originalHandleAddTask.apply(this, arguments);
        if (taskInput.value.trim() !== '') {
          playSound('add');
        }
        return result;
      };

      // Initialize all new features
      document.addEventListener('DOMContentLoaded', function() {
        createParticles();
        
        // Make existing tasks draggable
        taskList.querySelectorAll('li').forEach(makeTaskDraggable);
        
        // Show welcome achievement
        setTimeout(() => {
          if (achievements.length === 0) {
            showAchievement('👋 Welcome to your Enhanced To-Do List!');
          }
        }, 1000);
      });
    </script>
  </body>
</html>
